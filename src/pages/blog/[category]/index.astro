---
import type { GetStaticPaths } from "astro";
import BlogArchive from "@/components/BlogArchive.astro";
import { blog as blogConfig, type CategoryId } from "@/config/site";
import { getPostsByCategory, type BlogPost } from "@/lib/posts";

const CATEGORY_IDS = Object.keys(blogConfig.categories) as CategoryId[];

export const getStaticPaths = (async () => {
  const paths = [];
  for (const category of CATEGORY_IDS) {
    const posts = await getPostsByCategory(category);
    if (posts.length === 0) continue;
    paths.push({
      params: { category },
      props: { category, posts },
    });
  }
  return paths;
}) satisfies GetStaticPaths;

const { category, posts } = Astro.props as {
  category: CategoryId;
  posts: BlogPost[];
};

const categoryMeta = blogConfig.categories[category];
const title =
  posts.length > 0
    ? `${categoryMeta.name} Posts`
    : `${categoryMeta.name} posts`;
const description = categoryMeta.description;
---

<BlogArchive
  title={title}
  description={description}
  heading={categoryMeta.name}
  lede={categoryMeta.description}
  posts={posts}
  feedBase={`/blog/${category}`}
  activeCategory={category}
  categoryForTags={category}
  paginationLabel={`${categoryMeta.name} pagination`}
/>
