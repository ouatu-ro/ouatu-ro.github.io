---
import type { GetStaticPaths } from "astro";
import BlogArchive from "@/components/BlogArchive.astro";
import { POSTS_PER_PAGE } from "@/config/constants";
import { SITE_DESCRIPTION, SITE_TITLE } from "@/consts";
import { getAllPosts, type BlogPost } from "@/lib/posts";

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await getAllPosts();
  return paginate(posts, { pageSize: POSTS_PER_PAGE });
}) satisfies GetStaticPaths;

const { page } = Astro.props as {
  page: {
    data: BlogPost[];
    currentPage: number;
    lastPage: number;
    url: { prev?: string; next?: string };
  };
};

const posts = page.data;
const pageSuffix = page.currentPage === 1 ? "" : ` â€“ Page ${page.currentPage}`;
const pageTitle = `${SITE_TITLE} Blog${pageSuffix}`;
const pageDescription =
  page.currentPage === 1
    ? SITE_DESCRIPTION
    : `${SITE_TITLE} blog archive page ${page.currentPage}`;
---

<BlogArchive
  title={pageTitle}
  description={pageDescription}
  heading="Blog"
  lede="Deep dives, essays, and catalogues in one feed."
  posts={posts}
  feedBase="/blog"
  pagination={page}
  activeCategory="all"
  showCategoryTabs={true}
  showTagTabs={true}
  paginationLabel="Blog pagination"
/>
