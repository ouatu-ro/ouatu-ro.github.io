---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import "../../styles/pages/blog.css";
import ClientScripts from "../../components/ClientScripts.astro";
import "../../styles/pages/blog-index.css";

const essays = (await getCollection("essays")).sort((a, b) => {
  const first = a.data.pubDate ?? a.data.updatedDate ?? new Date(0);
  const second = b.data.pubDate ?? b.data.updatedDate ?? new Date(0);
  return second.getTime() - first.getTime();
});
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={`${SITE_TITLE} Essays`} description={SITE_DESCRIPTION} />
    <ClientScripts />
  </head>
  <body>
    <Header />
    <main class="blog-index-main">
      <section>
        {
          essays.length === 0 ? (
            <p>No essays published yet. Check back soon!</p>
          ) : (
            <ul class="blog-index-list">
              {essays.map((essay) => (
                <li>
                  <a href={`/essays/${essay.id}/`}>
                    {essay.data.heroImage ? (
                      <img
                        width={720}
                        height={360}
                        src={essay.data.heroImage}
                        alt=""
                      />
                    ) : (
                      <div class="blog-title-fallback">
                        <h3>{essay.data.title}</h3>
                      </div>
                    )}
                    <h4 class="title blog-index-title">{essay.data.title}</h4>
                    {(essay.data.pubDate || essay.data.updatedDate) && (
                      <p class="date blog-index-date">
                        <FormattedDate
                          date={essay.data.pubDate ?? essay.data.updatedDate!}
                        />
                      </p>
                    )}
                  </a>
                </li>
              ))}
            </ul>
          )
        }
      </section>
    </main>
    <Footer />
  </body>
</html>
