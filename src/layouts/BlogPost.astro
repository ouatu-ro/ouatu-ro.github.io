---
import FormattedDate from "../components/FormattedDate.astro";
import SubscribePrompt from "../components/SubscribePrompt.astro";
import { CATEGORIES, type CategoryId } from "../config/categories";
import BaseLayout from "./BaseLayout.astro";
import "../styles/pages/blog.css";
import "katex/dist/katex.min.css";

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  heroImage?: string;
  ogImage?: string;
  math?: boolean;
  readingTime: number;
  category: CategoryId;
  tags?: Array<{ label: string; slug: string }>;
}

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  ogImage,
  math,
  readingTime,
  category,
  tags = [],
} = Astro.props;

const categoryMeta = CATEGORIES[category];
const imageForMeta = ogImage ?? heroImage;
---

<BaseLayout
  title={title}
  description={description}
  image={imageForMeta}
  mainClass="blog-post-layout"
>
  <article>
    <div class="hero-image">
      {heroImage && <img width={1020} height={510} src={heroImage} alt="" />}
    </div>

    <div class="prose">
      <div class="title">
        <div class="meta">
          <div class="meta__dates">
            <FormattedDate date={pubDate} />
            {
              updatedDate && (
                <div class="last-updated-on">
                  Updated <FormattedDate date={updatedDate} />
                </div>
              )
            }
          </div>
          <div class="meta__details">
            <a class="meta-pill meta-pill--link" href={`/blog/${category}/`}>
              {categoryMeta?.name ?? category}
            </a>
            <span class="meta-pill">{readingTime} min read</span>
          </div>
        </div>
        <h1>{title}</h1>
        <p class="lede">{description}</p>
        <hr />
      </div>
      <slot />
      {
        tags.length > 0 && (
          <div class="post-tags" aria-label="Tags">
            {tags.map((tag) => (
              <a class="meta-pill" href={`/blog/${category}/tag/${tag.slug}/`}>
                #{tag.label}
              </a>
            ))}
          </div>
        )
      }
    </div>
  </article>
  <SubscribePrompt categoryId={category} />
</BaseLayout>
