---
import type { ProjectRecord } from "../../lib/projects";

interface Props {
  project: ProjectRecord;
}

const { project } = Astro.props as Props;
const terminalLines = createTerminalLines(project);

function createTerminalLines(project: ProjectRecord) {
  const promptName = toPromptName(project);
  return [
    `> launch ${promptName}`,
    "# compiling modules… ok",
    "# running simulation…",
    "# solved in 0.13s",
  ];
}

function toPromptName(project: ProjectRecord) {
  const source = project.slug || project.name || "";
  const normalized = source.toLowerCase().replace(/[^a-z0-9]+/g, "-");
  return normalized.replace(/-([a-z0-9])/g, (_, char) => char.toUpperCase());
}
---

<div class="terminal-screen">
  <div class="terminal-status-bar">
    <span class="terminal-dot is-red"></span>
    <span class="terminal-dot is-yellow"></span>
    <span class="terminal-dot is-green"></span>
  </div>
  {
    terminalLines.map((line, index) => (
      <div
        class:list={["terminal-line", { "terminal-prompt": index === 0 }]}
        data-line-index={index}
      >
        {line}
        {index === terminalLines.length - 1 && <span class="terminal-cursor" />}
      </div>
    ))
  }
</div>

<style>
  :global(.project-card-media--terminal) {
    background:
      radial-gradient(
        circle at top left,
        rgba(55, 158, 255, 0.45),
        rgba(10, 15, 28, 0.9)
      ),
      linear-gradient(160deg, rgba(9, 24, 45, 0.9), rgba(4, 12, 26, 0.95));
    font-family: "Source Code Pro", "Fira Code", monospace;
  }

  .terminal-screen {
    width: 90%;
    height: 85%;
    border-radius: 14px;
    padding: 1.35rem;
    background: rgba(5, 10, 22, 0.92);
    border: 1px solid rgba(135, 255, 196, 0.24);
    box-shadow:
      inset 0 0 18px rgba(135, 255, 196, 0.13),
      0 0 40px rgba(12, 226, 171, 0.18);
    position: relative;
  }

  .terminal-status-bar {
    display: flex;
    gap: 0.55rem;
    margin-bottom: 1.05rem;
  }

  .terminal-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    opacity: 0.7;
  }

  .terminal-dot.is-red {
    background: #ff6b6b;
  }

  .terminal-dot.is-yellow {
    background: #ffd166;
  }

  .terminal-dot.is-green {
    background: #06d6a0;
  }

  .terminal-line {
    color: #8fffd4;
    margin-bottom: 0.35rem;
    font-size: 0.9rem;
  }

  .terminal-prompt {
    color: #56f6d2;
  }

  .terminal-cursor {
    display: inline-block;
    width: 0.6rem;
    background: #56f6d2;
    margin-left: 0.2rem;
    animation: terminalCursorBlink 1.1s steps(2, start) infinite;
  }

  @keyframes terminalCursorBlink {
    50% {
      opacity: 0;
    }
  }
</style>
