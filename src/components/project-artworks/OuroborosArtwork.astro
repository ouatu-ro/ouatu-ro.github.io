---
interface Props extends Record<string, any> {
  label: string;
}
const { label } = Astro.props;
---

<div class="infinity-container">
  <svg class="infinity-svg" viewBox="0 0 100 50" aria-hidden="true">
    <!-- Symmetric infinity path (sideways figure-eight) -->
    <path
      class="infinity-track"
      d="M10,25
         C10,5 40,5 50,25
         C60,45 90,45 90,25
         C90,5 60,5 50,25
         C40,45 10,45 10,25"
    ></path>

    <g class="comet-group">
      <circle class="comet-blur" cx="0" cy="0" r="6" fill="url(#comet-glow)"
      ></circle>
      <circle class="comet-head" cx="0" cy="0" r="2.5" fill="#e0fff8"></circle>
    </g>

    <defs>
      <radialGradient id="comet-glow">
        <stop offset="0%" stop-color="#6CFFB3" stop-opacity="0.6"></stop>
        <stop offset="100%" stop-color="#6CFFB3" stop-opacity="0"></stop>
      </radialGradient>
    </defs>
  </svg>
</div>

<style>
  :global(.project-card-media--ouroboros) {
    display: grid;
    place-items: center;
    background: radial-gradient(
      circle at 50% 50%,
      rgba(12, 16, 28, 0.94),
      rgba(108, 93, 255, 0.08)
    );
  }

  .infinity-container {
    width: 70%;
    max-width: 160px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .infinity-svg {
    width: 100%;
    height: auto;
    overflow: visible;
  }

  .infinity-track {
    fill: none;
    stroke: rgba(108, 255, 179, 0.18);
    stroke-width: 1;
    stroke-linecap: round;
    filter: drop-shadow(0 0 6px rgba(108, 255, 179, 0.2));
  }

  .comet-group {
    /* Follow the exact same path as the track */
    offset-path: path(
      "M10,25 C10,5 40,5 50,25 C60,45 90,45 90,25 C90,5 60,5 50,25 C40,45 10,45 10,25"
    );
    offset-rotate: auto; /* face along the tangent */
    will-change: offset-distance;
  }

  .comet-head {
    filter: drop-shadow(0 0 5px #c0fff0);
  }

  .infinity-label {
    margin-top: 0.5rem;
    font-size: clamp(0.9rem, 3vw, 1.4rem);
    font-weight: 500;
    letter-spacing: 0.2em;
    color: rgba(255, 255, 255, 0.75);
    text-transform: uppercase;
  }

  @media (prefers-reduced-motion: reduce) {
    .comet-group {
      animation: none !important;
    }
  }
</style>

<!-- Smooth speed-up/slow-down without losing position -->
<script>
  const comet = document.querySelector(".comet-group");
  // Drive the progression with WAAPI (no CSS keyframes; no restarts).
  const anim = comet.animate(
    [{ offsetDistance: "0%" }, { offsetDistance: "100%" }],
    { duration: 6000, iterations: Infinity, easing: "linear" },
  );

  // Find the hover target (whole card if present, else the component itself)
  const hoverTarget =
    comet.closest(".project-card-link") ||
    document.querySelector(".infinity-container");

  function tweenPlaybackRate(target, ms = 800) {
    const start = anim.playbackRate;
    const t0 = performance.now();
    function step(now) {
      const t = Math.min(1, (now - t0) / ms);
      anim.playbackRate = start + (target - start) * t;
      if (t < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  hoverTarget?.addEventListener("mouseenter", () => tweenPlaybackRate(8)); // faster on hover
  hoverTarget?.addEventListener("mouseleave", () => tweenPlaybackRate(1)); // back to normal
</script>
