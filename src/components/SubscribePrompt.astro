---
import type { CategoryId } from "../config/categories";
import { CATEGORIES } from "../config/categories";
import { normalizeTag } from "../lib/posts";

interface Props {
  categoryId?: CategoryId;
  tagSlug?: string;
  tagLabel?: string;
}

const { categoryId, tagSlug, tagLabel } = Astro.props as Props;

const scopedCategory = categoryId ? CATEGORIES[categoryId] : undefined;
const normalizedTag = tagSlug ? normalizeTag(tagSlug) : undefined;
const scopedTagLabel = tagLabel ?? tagSlug;

const categoryFeedBase = categoryId ? `/blog/${categoryId}` : undefined;
const tagFeedBase =
  normalizedTag && categoryFeedBase
    ? `${categoryFeedBase}/tag/${normalizedTag}`
    : undefined;
---
<section class="subscribe-prompt">
  <h3>Stay in the Loop</h3>
  <p>
    Get notified when I publish new writing.
    {scopedCategory && ` This block follows the ${scopedCategory.name} stream.`}
    {normalizedTag && ` This block covers posts tagged "${scopedTagLabel}".`}
  </p>
  <div class="subscribe-prompt__links">
    <a href="/blog/rss.xml" class="btn btn-primary" rel="nofollow">
      Subscribe to All Posts
    </a>
    <a href="/blog/feed.json" class="btn btn-secondary" rel="nofollow">
      JSON Feed
    </a>
    {categoryFeedBase && scopedCategory && (
      <a href={`${categoryFeedBase}/rss.xml`} class="btn" rel="nofollow">
        {`Only ${scopedCategory.name}`}
      </a>
    )}
    {categoryFeedBase && scopedCategory && (
      <a href={`${categoryFeedBase}/feed.json`} class="btn btn-secondary" rel="nofollow">
        {`${scopedCategory.name} JSON`}
      </a>
    )}
    {tagFeedBase && normalizedTag && (
      <a href={`${tagFeedBase}/rss.xml`} class="btn" rel="nofollow">
        {`Only #${normalizedTag}`}
      </a>
    )}
    {tagFeedBase && normalizedTag && (
      <a href={`${tagFeedBase}/feed.json`} class="btn btn-secondary" rel="nofollow">
        {`#${normalizedTag} JSON`}
      </a>
    )}
  </div>
</section>
